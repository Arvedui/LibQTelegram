#ifndef MTPROTOSERVICEHANDLER_H
#define MTPROTOSERVICEHANDLER_H

#include <QObject>
#include "mtprotoreply.h"
#include "../autogenerated/mtproto/mtproto.h"
#include "../autogenerated/types/types.h"
#include "../config/telegramconfig.h"
#include "../types/time.h"

class MTProtoServiceHandler : public QObject
{
    Q_OBJECT

    public:
        explicit MTProtoServiceHandler(DCConfig* dcconfig, QObject *parent = 0);
        bool handle(MTProtoReply* mtreply);

    signals:
        void ackRequest(TLLong reqmsgid);
        void ack(const TLVector<TLLong>& msgids);
        void serviceHandled(MTProtoReply* mtreply);
        void migrateDC(DCConfig* fromdcconfig, int todcid);
        void saltChanged(TLLong newserversalt, TLLong reqmsgid);
        void deltaTimeChanged(TLLong deltatime, TLLong reqmsgid);
        void unauthorized();
        void floodLock(int seconds);
        void invalidPassword();
        void sessionPasswordNeeded();
        void phoneCodeError(QString errormessage);

    private:
        void checkRepeat(BadMsgNotification* badmsgnotification, TLLong servermsgid);

    private:
        void handleMsgContainer(MTProtoReply* mtreply);
        void handleRpcResult(MTProtoReply* mtreply);
        void handleRpcError(MTProtoReply* mtreply);
        void handleBadMsgNotification(MTProtoReply* mtreply);
        void handleGzipPacked(MTProtoReply* mtreply);
        void handleNewSessionCreated(MTProtoReply* mtreply);
        void handleMsgAck(MTProtoReply* mtreply);

    private:
        DCConfig* _dcconfig;
};

#endif // MTPROTOSERVICEHANDLER_H
