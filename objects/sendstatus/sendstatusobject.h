#ifndef SENDSTATUSOBJECT_H
#define SENDSTATUSOBJECT_H

/*
 * From Telegram documentation: https://core.telegram.org/constructor/updateUserTyping
 * If no repeated update received after 6 seconds, it should be considered that the user stopped doing whatever he's been doing.
 */

#define StatusTimeout 6000 // 6 seconds

#include <QObject>
#include <QTimer>
#include "../../autogenerated/types/types.h"

class SendStatusObject : public QObject
{
    Q_OBJECT

    public:
        explicit SendStatusObject(Dialog* dialog, QObject *parent = 0);
        Dialog* dialog() const;
        void update(User* user, SendMessageAction *sendmessageaction, bool fromchat);
        QString sendStatusText() const;

    private:
        bool isCancelled(SendMessageAction* sendaction) const;
        void updateStatusText(SendMessageAction* sendmessageaction, bool fromchat);
        QString createStatusText(SendMessageAction* sendmessageaction) const;
        QString createUserPrefix() const;

    signals:
        void expired();

    private:
        Dialog* _dialog;
        QSet<User*> _users;
        QTimer* _timexpired;
        QString _sendstatustext;
};

#endif // SENDSTATUSOBJECT_H
